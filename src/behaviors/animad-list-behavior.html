<script>
    /**
     * Behavior, um einer beliebigen Liste (Read, Delete) alle Eigenschaften
     * wie Properties und Methoden zu geben, die es benötigt um mit dem Server zu
     * kommunizieren.
     *
     * @polymerMixinClass
     */
    /* @polymerMixin */
    let AnimadListBehavior = (superClass) => class extends superClass {

        static get properties() {
            return {
              data: {
                type: Array,
                value() {
                  return [];
                }
              },
              /*
                Das _filteredData array enthält alle Objekte, die auf angegebene oder ausgewählte Filter zutreffen.
                Die Tabelle zeigt die Einträge aus _filteredData an.
                GENERATOR: _filteredData
              */
              filteredData: {
                type: Array,
                value() {
                  return this.data;
                }
              },
              /*
               _deleteInfo enthält beim Löschen über Papierkorb die Information über den zu
               löschenden Datensatz. Nach Bestätigung oder Abbruch des Löschvorgangs wird
               die Information aus _deleteInfo wieder gelöscht.
              */
              _deleteInfo: {
                type: String,
                value: ""
              },
              /*
               _deleteItem enthält beim Löschen über Papierkorb den zu löschenden Datensatz.
               Nach Bestätigung oder Abbruch des Löschvorgangs wird _deleteItem wieder
               in den Initial-Zustand zurückgesetzt.
              */
              _deleteItems: {
                type: Array,
                value: []
              },
              /*
                _selectedItems enthält alle in der Liste selektierten Datensätze
              */
              _selectedItems: {
                type: Array,
                value() {
                  return [];
                }
              },
              /*
                _disableDeleteButton deaktiviert (true) oder aktiviert (false) den Delete-Button
              */
              _disableDeleteButton: {
                type: Boolean,
                value: true
              },
              /* _backendData enthält die Antwort des Backend-Aufrufs als JSON String*/
              _backendData: {
                type: Object,
                observer: '_backendDataChanged'
              },
            }
        }

        static get observers() {
          return [
            '_selectionChanged(_selectedItems.length)',
            '_dataChanged(data.length)'
          ]
        }

        // Override / Enhance to handle data individually
        _dataChanged(dataLength) {
          // unset temporary delete information
          this.unsetTemporaryDeleteInfo();
        }

        // Override to handle backendData individually
        _backendDataChanged(backendData, backendDataOld){
          // Assignmetn triggers observer _dataChanged
          this.data = backendData;
        }

        _selectionChanged(nrSelectedItems) {
          this._disableDeleteButton = (nrSelectedItems === 0);
        }

        // Deletes all data that is contained in array _deleteItems
        _deleteSelectedRows() {
          var items = this._deleteItems;
          var allItems = this.data;

          // loop over all items to delete
          for (var i in items) {
            // TBD: Daten im Backend löschen -> data
            var j = this.data.indexOf(items[i]);
            allItems.splice(j, 1);
          }

          // triggers observer _dataChanged
          this.data = allItems;
          this.notifyPath('data.length');
        }

        unsetTemporaryDeleteInfo() {
          this._deleteItems = [];
          this._deleteInfo = "";
        }

        // Backend methods
        handleResponse(e) {
          if (e.detail) {
            this._backendData = e.detail.__data.response;
          }
        }


    };
</script>
